<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC	"-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- mapper 태그 안에 작성하기 -->
<mapper namespace="com.spring.madi.BoardMapper">
	<resultMap type="BoardVO" id="BoardResultMap">
		<result property="board_num" column="BOARD_NUM" />
		<result property="user_id" column="USER_ID" />
		<result property="board_title" column="BOARD_TITLE" />
		<result property="board_summry" column="BOARD_SUMMRY" />
		<result property="board_img" column="BOARD_IMG" />
		<result property="board_recipe_id" column="BOARD_RECIPE_ID" />
		<result property="board_like" column="BOARD_LIKE" />
		<result property="board_time" column="BOARD_TIME" />
	</resultMap>
	
	<resultMap type="BoardReplyVO" id="BoardReplyResultMap">
		<result property="board_num" column="BOARD_NUM" />
		<result property="user_id" column="USER_ID" />
		<result property="rep_content" column="REP_CONTENT" />
	</resultMap>
	
	<resultMap type="UserLikeBoVO" id="UserLikeBoResultMap">
		<result property="user_id" column="USER_ID" />
		<result property="board_num" column="BOARD_NUM" />
	</resultMap>	
	
	
	<!-- (진산) 로그인한 아이디 자신에 대한 member정보 -->
	<select id="getMember" resultMap="MemberResultMap">
		SELECT * FROM member WHERE user_id= #{user_id, javaType=String}
	</select>
	<!-- (진산) 팔로워 구하기 ..following_user_id는 내 아이디를 입력함-->
	<select id="getFollower" resultMap="MemberFollowResultMap">
		SELECT * FROM member WHERE user_id in 
		(SELECT user_id FROM member_follow WHERE following_user_id= #{following_user_id, javaType=String})
	</select>
	<!-- (진산) 팔로잉 구하기 -->
	<select id="getFollowing" resultMap="MemberFollowResultMap">
		SELECT * FROM member WHERE user_id in 
		(SELECT following_user_id FROM member_follow WHERE user_id= #{user_id, javaType=String})
	</select>
	<!-- (진산) 팔로워 추천 목록 불러오기 -->
	<select id="getRecommendFollower" resultMap="MemberFollowResultMap">
		SELECT * FROM member WHERE user_id in
		(SELECT following_user_id FROM (SELECT following_user_id, count(user_id) as follower_count
		FROM member_follow GROUP BY following_user_id ORDER BY follower_count))
	</select>
	<!-- (진산) 팔로잉 한 명 지우기 -->
	<delete id="deleteFollowing" parameterType="com.spring.madi.MemberFollowVO">
		DELETE FROM member_follow 
		WHERE following_user_id= #{following_user_id, javaType=String}
	</delete>
	<!-- (진산) 팔로잉 한 명 추가 -->
	<insert id="insertFollowing" parameterType="com.spring.madi.MemberFollowVO">
		INSERT INTO member_follow 
		VALUES (#{user_id, javaType=String}, #{following_user_id, javaType=String})
	</insert>
</mapper>